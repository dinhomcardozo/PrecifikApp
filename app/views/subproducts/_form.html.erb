<%= turbo_frame_tag dom_id(subproduct) do %>
  <%= form_with model: subproduct, html: { multipart: true } do |f| %>
    <h4>Configurações do Subproduto</h4>

    <div class="mb-3">
      <%= f.label :name, "Nome do Subproduto" %>
      <%= f.text_field :name, class: "form-control" %>
    </div>

    <div class="mb-3">
      <%= f.label :brand_id, "Marca" %>
      <%= f.collection_select :brand_id, Brand.all, :id, :name,
                              include_blank: true,
                              class: "form-select" %>
    </div>

    <h4>Composição do Subproduto</h4>

    <div id="subproduct_total_cost" class="mb-2">
      Custo Total: R$ <%= number_with_precision(subproduct.total_composition_cost, precision: 2) %>
    </div>

    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Insumo</th>
          <th>Quantidade</th>
          <th>Custo (R$)</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody data-controller="nested-form" data-nested-form-target="container">
        <%= f.fields_for :subproduct_compositions do |ff| %>
          <%= render "subproducts/subproduct_compositions_fields", f: ff %>
        <% end %>
      </tbody>
    </table>

    <%= link_to "Adicionar Insumo", "#",
                class: "action-button",
                data: {
                  action: "nested-form#addField",
                  association: "subproduct_compositions",
                  id: Time.now.to_i,
                  fields: f.fields_for(:subproduct_compositions, SubproductComposition.new, child_index: "NEW_RECORD") do |ff|
                    render("subproducts/subproduct_compositions_fields", f: ff)
                  end.delete("\n")
                } %>
    
<br>
    <div class="mt-4">
      <%= f.submit "Salvar subproduto", class: "standart-button" %>
    </div>
  <% end %>
<% end %>