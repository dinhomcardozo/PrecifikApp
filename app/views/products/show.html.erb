<!-- app/views/products/show.html.erb -->

<main class="index-container">
  <%= turbo_frame_tag "product_steps" do %>
    <h1 class="title">Detalhes do Produto</h1>

    <div>
      <div class="custom-label">
        <%= link_to "<- Voltar",
                    products_path,
                    data: { turbo_frame: "product_steps", turbo_action: "advance" },
                    class: "standart-button" %>
        <%= link_to "Editar",
                    edit_product_path(@product, step: 1),
                    data: { turbo_frame: "product_steps" },
                    class: "action-button",
                    title: "Editar" %>
      </div>
    </div>

    <table class="vertical-table--bordered">
      <tr>
        <th>Descrição:</th>
        <td><%= @product.description %></td>
      </tr>
      <tr>
        <th>Marca:</th>
        <td><%= @product.brand&.name %></td>
      </tr>
      <tr>
        <th>Imagem:</th>
        <td>
          <% if @product.image.attached? %>
            <%= image_tag url_for(@product.image), alt: @product.description, class: "index_image", width: 300, height: 300 %>
          <% else %>
            Nenhuma
          <% end %>
        </td>
      </tr>
      <tr>
        <th>Total Custo (R$):</th>
        <td><%= number_to_currency(@product.total_cost, unit: "R$ ") %></td>
      </tr>
      <tr>
        <th>Total c/ Tributos (R$):</th>
        <td><%= number_to_currency(@product.total_cost_with_taxes, unit: "R$ ") %></td>
      </tr>
      <tr>
        <th>Preço Sugerido Varejo (R$):</th>
        <td><%= number_to_currency(@product.suggested_price_retail, unit: "R$ ") %></td>
      </tr>
      <tr>
        <th>Preço Sugerido Atacado (R$):</th>
        <td><%= number_to_currency(@product.suggested_price_wholesale, unit: "R$ ") %></td>
      </tr>
      <tr>
        <th>Lucro Líquido Varejo (R$):</th>
        <td><%= number_to_currency(@product.net_profit_retail, unit: "R$ ") %></td>
      </tr>
      <tr>
        <th>Lucro Líquido Atacado (R$):</th>
        <td><%= number_to_currency(@product.net_profit_wholesale, unit: "R$ ") %></td>
      </tr>
    </table>

    <hr>

    <section class="show-composition mb-4">
      <h2 class="subtitle">Composição</h2>
      <table class="index-table index-table--bordered">
        <thead>
          <tr>
            <th>Insumo</th>
            <th>Quantidade</th>
            <th>Custo Unitário (R$)</th>
          </tr>
        </thead>
        <tbody>
          <% @product.product_subproducts.each do |ps| %>
            <tr>
              <td><%= ps.subproduct.name %></td>
              <td><%= ps.product.final_weight %></td>
              <td><%= number_to_currency(ps.cost, unit: "R$ ") %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </section>
    <hr>
  <% end %>

  <div class="detailed-box">
    <div>
      <p class="detailed-text">
        <strong>ATENÇÃO!</strong> Edite isso com cuidado. Outros itens podem depender deste Produto.
      </p>                 
      <p class="dependent-item-count">
        <%= "Você tem " + "#{pluralize(@services_count, 'Serviço')}" + " utilizando este item" %>.
        <a href="#" data-bs-toggle="modal" data-bs-target="#assocModal">
          Clique aqui e veja a lista.
        </a>
      </p>
      <div>
        <%= render "product_dependent_items_modal",
                  services: @services %>
      </div>
    </div>
  </div>

</main>